<!-- Don't forget to use nuget package manager to install the json.net package -->
<!DOCTYPE html>
<html>

	<div style="position: absolute; left: 15vw; width: 70vw;">
		
		<div style="font-size: 30px; font-weight: bold; margin-bottom: 20px;">
			Full-Stack Chat App - Version 3
		</div>

		<div id="messages" 
			style="
				font-size: 20px;
				height: calc(100vh - 120px);
				overflow-x: hidden;
				overflow-y: auto;
				margin-bottom: 10px;">
		</div>

		<div style="margin-bottom: 20px;">

			<input id="usernameInput" type="text" placeholder="Username"
				style="width: 100px; font-size: 20px;">

			<input id="messageInput" type="text" placeholder="Message"
				style="width: calc(70vw - 200px); font-size: 20px;">

			<button id="sendButton"
				style="font-size: 20px; width: 70px;">
				Send!
			</button>

		</div>

	</div>

	<body>

		<script>

			const messages = document.getElementById("messages");
			const usernameInput = document.getElementById("usernameInput");
			const messageInput = document.getElementById("messageInput");
			const sendButton = document.getElementById("sendButton");

			var messageCount = 0;

			setInterval(() =>
			{
				//messages.innerText = "Test";
				//if api + html/js comes from same server, server name is optional in FETCH request, if not, be explicit
				fetch("/messages", { method: "GET" }).then(response =>
				{
					if (!response.ok) return;
					response.json().then(restMessages =>
					{
						messages.innerText = restMessages.join("\n");

						if (restMessages.length > messageCount)
							messages.scrollTop = messages.scrollHeight;
						
						messageCount = restMessages.length;
					});
				});
			}, 500);

			// Use = for assignment, use == for checking Nulls/Undefined, use === for equality

			const send = () =>
			{
				if (usernameInput.value == null || usernameInput.value === "") return;

				const message = `${usernameInput.value}: ${messageInput.value}`;
				fetch("/messages", { method: "PUT", body: message });
				messageInput.value = "";
			};

			sendButton.onclick = () => send();

			messageInput.onkeypress = e => { if (e.key === "Enter") send();	}

		</script>

	</body>

</html>